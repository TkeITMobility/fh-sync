<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dataHandlers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dataHandlers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var syncUtil = require('./util');
module.exports = function(options) {

  if (!options || options.defaultHandlers === undefined) {
    throw new Error('Default handlers were not passed in options.');
  }

  var names = {
    LIST: 'listHandler',
    CREATE: 'createHandler',
    READ: 'readHandler',
    UPDATE: 'updateHandler',
    DELETE: 'deleteHandler',
    COLLISION: 'collisionHandler',
    LIST_COLLISIONS: 'listCollisionsHandler',
    REMOVE_COLLISION: 'removeCollisionHandler'
  }
  var handlers;
  var globalHandlers;

  function initHandlers() {
    handlers = {};
    globalHandlers = {
      listHandler : options.defaultHandlers.doList,
      createHandler : options.defaultHandlers.doCreate,
      readHandler : options.defaultHandlers.doRead,
      updateHandler : options.defaultHandlers.doUpdate,
      deleteHandler : options.defaultHandlers.doDelete,
      collisionHandler : options.defaultHandlers.handleCollision,
      listCollisionsHandler : options.defaultHandlers.listCollisions,
      removeCollisionHandler : options.defaultHandlers.removeCollision
    }
  }

  initHandlers();

  return {

    /**
     * Sets a custom list handler for the passed-in dataset
     * @param datasetId
     * @param handler
     */
    listHandler: function(datasetId, handler) {
      setHandler(datasetId, names.LIST, handler);
    },

    /**
     * Sets a custom create handler for the passed-in dataset
     * @param datasetId
     * @param handler
     */
    createHandler: function(datasetId, handler) {
      setHandler(datasetId, names.CREATE, handler);
    },

    /**
     * Sets a custom read handler for the passed-in dataset
     * @param datasetId
     * @param handler
     */
    readHandler: function(datasetId, handler) {
      setHandler(datasetId, names.READ, handler);
    },

    /**
     * Sets a custom update handler for the passed-in dataset
     * @param datasetId
     * @param handler
     */
    updateHandler: function(datasetId, handler) {
      setHandler(datasetId, names.UPDATE, handler);
    },

    /**
     * Sets a custom delete handler for the passed-in dataset
     * @param datasetId
     * @param handler
     */
    deleteHandler: function(datasetId, handler) {
      setHandler(datasetId, names.DELETE, handler);
    },

    /**
     * Sets a custom collision handler for the passed-in dataset
     * @param datasetId
     * @param handler
     */
    collisionHandler: function(datasetId, handler) {
      setHandler(datasetId, names.COLLISION, handler);
    },

   /**
     * Sets a custom list collision handler for the passed-in dataset
     * @param datasetId
     * @param handler
     */
    listCollisionsHandler: function(datasetId, handler) {
      setHandler(datasetId, names.LIST_COLLISIONS, handler);
    },

    /**
     * Sets a custom remove collision handler for the passed-in dataset
     * @param datasetId
     * @param handler
     */
    removeCollisionHandler: function(datasetId, handler) {
      setHandler(datasetId, names.REMOVE_COLLISION, handler);
    },

    /**
     * Sets a customer global list handler
     * @param {Function} handler
     */
    globalListHandler: function(handler) {
      setGlobalHander(names.LIST, handler);
    },

    /**
     * Sets a customer global create handler
     * @param {Function} handler
     */
    globalCreateHandler: function(handler) {
      setGlobalHander(names.CREATE, handler);
    },

    /**
     * Sets a customer global read handler
     * @param {Function} handler
     */
    globalReadHandler: function(handler) {
      setGlobalHander(names.READ, handler);
    },

    /**
     * Sets a customer global update handler
     * @param {Function} handler
     */
    globalUpdateHandler : function(handler) {
      setGlobalHander(names.UPDATE, handler);
    },

    /**
     * Sets a customer global delete handler
     * @param {Function} handler
     */
    globalDeleteHandler : function(handler) {
      setGlobalHander(names.DELETE, handler);
    },

    /**
     * Sets a customer global collision handler
     * @param {Function} handler
     */
    globalCollisionHandler: function(handler) {
      setGlobalHander(names.COLLISION, handler);
    },

    /**
     * Sets a customer global list collision handler
     * @param {Function} handler
     */
    globalListCollisionsHandler: function(handler) {
      setGlobalHander(names.LIST_COLLISIONS, handler);
    },

    /**
     * Sets a customer global remove collision handler
     * @param {Function} handler
     */
    globalRemoveCollisionHandler: function(handler) {
      setGlobalHander(names.REMOVE_COLLISION, handler);
    },

    /**
     * @param datasetId
     * @param queryParams
     * @param metaData
     * @param callback
     */
    doList: function(datasetId, queryParams, metaData, callback) {
      var handler = handlerFor(datasetId, names.LIST);
      handler(datasetId, queryParams, metaData, callback);
    },

    /**
     * @param datasetId
     * @param record
     * @param metaData
     * @param callback
     */
    doCreate: function(datasetId, data, metaData, callback) {
      var handler = handlerFor(datasetId, names.CREATE);
      handler(datasetId, data, metaData, callback);
    },

    /**
     * @param datasetId
     * @param uid
     * @param metaData
     * @param callback
     */
    doRead: function(datasetId, uid, metaData, callback) {
      var handler = handlerFor(datasetId, names.READ);
      handler(datasetId, uid, metaData, callback);
    },

    /**
     * @param datasetId
     * @param uid
     * @param record
     * @param metaData
     * @param callback
     */
    doUpdate: function(datasetId, uid, record, metaData, callback) {
      var handler = handlerFor(datasetId, names.UPDATE);
      handler(datasetId, uid, record, metaData, callback);
    },

    /**
     * @param datasetId
     * @param uid
     * @param metaData
     * @param callback
     */
    doDelete: function(datasetId, uid, metaData, callback) {
      var handler = handlerFor(datasetId, names.DELETE);
      handler(datasetId, uid, metaData, callback);
    },

    /**
     * @param datasetId
     * @param metaData
     * @param collisionFields
     */
    handleCollision: function(datasetId, hash, timestamp, uid, pre, post, metaData, callback){
      var handler = handlerFor(datasetId, names.COLLISION);
      handler(datasetId, hash, timestamp, uid, pre, post, metaData, callback);
    },

    /**
     * @param datasetId
     * @param metaData
     * @param callback
     */
    listCollisions: function(datasetId, metaData, callback) {
      var handler = handlerFor(datasetId, names.LIST_COLLISIONS);
      handler(datasetId, metaData, callback);
    },

    /**
     * @param datasetId
     * @param dataHash
     * @param metaData
     * @param callback
     */
    removeCollision: function(datasetId, dataHash, metaData, callback) {
      var handler = handlerFor(datasetId, names.REMOVE_COLLISION);
      handler(datasetId, dataHash, metaData, callback);
    },

    restore: initHandlers
  };

  function setHandler(datasetId, handlerName, handler) {
    syncUtil.ensureHandlerIsFunction(handlerName, handler);
    var handlers = handlersFor(datasetId);
    handlers[handlerName] = handler;
  }

  function setGlobalHander(handlerName, handler) {
    syncUtil.ensureHandlerIsFunction(handlerName, handler);
    globalHandlers[handlerName] = handler;
  }

  function handlerFor(datasetId, handlerName) {
    var handler = handlersFor(datasetId)[handlerName];
    if (!handler) {
      handler = globalHandlers[handlerName];
    }
    return handler;
  }

  function handlersFor(datasetId) {
    var handler = handlers[datasetId];
    if (!handler) {
      handler = {};
      handlers[datasetId] = handler;
    }
    return handler;
  }

};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addToQueue">addToQueue</a></li><li><a href="global.html#aggregateData">aggregateData</a></li><li><a href="global.html#applyPendingChange">applyPendingChange</a></li><li><a href="global.html#collisionHandler">collisionHandler</a></li><li><a href="global.html#computeDelta">computeDelta</a></li><li><a href="global.html#connect">connect</a></li><li><a href="global.html#convertToObject">convertToObject</a></li><li><a href="global.html#createHandler">createHandler</a></li><li><a href="global.html#DatasetClient">DatasetClient</a></li><li><a href="global.html#DatasetClientsCleaner">DatasetClientsCleaner</a></li><li><a href="global.html#debugError">debugError</a></li><li><a href="global.html#DEFAULT_SYNC_CONF">DEFAULT_SYNC_CONF</a></li><li><a href="global.html#defaultHashFn">defaultHashFn</a></li><li><a href="global.html#del">del</a></li><li><a href="global.html#deleteHandler">deleteHandler</a></li><li><a href="global.html#doCreate">doCreate</a></li><li><a href="global.html#doDelete">doDelete</a></li><li><a href="global.html#doList">doList</a></li><li><a href="global.html#doRead">doRead</a></li><li><a href="global.html#doUpdate">doUpdate</a></li><li><a href="global.html#ensureQueueCreated">ensureQueueCreated</a></li><li><a href="global.html#formatUpdates">formatUpdates</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getDefaultHashFn">getDefaultHashFn</a></li><li><a href="global.html#getGlobalHashFn">getGlobalHashFn</a></li><li><a href="global.html#getRecordHashFn">getRecordHashFn</a></li><li><a href="global.html#globalCollisionHandler">globalCollisionHandler</a></li><li><a href="global.html#globalCreateHandler">globalCreateHandler</a></li><li><a href="global.html#globalDeleteHandler">globalDeleteHandler</a></li><li><a href="global.html#globalHash">globalHash</a></li><li><a href="global.html#globalListCollisionsHandler">globalListCollisionsHandler</a></li><li><a href="global.html#globalListHandler">globalListHandler</a></li><li><a href="global.html#globalReadHandler">globalReadHandler</a></li><li><a href="global.html#globalRemoveCollisionHandler">globalRemoveCollisionHandler</a></li><li><a href="global.html#globalUpdateHandler">globalUpdateHandler</a></li><li><a href="global.html#handleCollision">handleCollision</a></li><li><a href="global.html#handleRedisError">handleRedisError</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#invoke">invoke</a></li><li><a href="global.html#invokeFunctions">invokeFunctions</a></li><li><a href="global.html#listAppliedChangeSinceLastSync">listAppliedChangeSinceLastSync</a></li><li><a href="global.html#listChangesNotInLocalDataset">listChangesNotInLocalDataset</a></li><li><a href="global.html#listCollisions">listCollisions</a></li><li><a href="global.html#listCollisionsHandler">listCollisionsHandler</a></li><li><a href="global.html#listHandler">listHandler</a></li><li><a href="global.html#listLocalDatasetClientData">listLocalDatasetClientData</a></li><li><a href="global.html#listPendingChangesForClient">listPendingChangesForClient</a></li><li><a href="global.html#MongodbQueue">MongodbQueue</a></li><li><a href="global.html#overrides">overrides</a></li><li><a href="global.html#processAcknowledgement">processAcknowledgement</a></li><li><a href="global.html#QueueWorker">QueueWorker</a></li><li><a href="global.html#readHandler">readHandler</a></li><li><a href="global.html#recordHash">recordHash</a></li><li><a href="global.html#removeAppliedUpdates">removeAppliedUpdates</a></li><li><a href="global.html#removeCollision">removeCollision</a></li><li><a href="global.html#removeCollisionHandler">removeCollisionHandler</a></li><li><a href="global.html#removePendingChanges">removePendingChanges</a></li><li><a href="global.html#removeUpdatesInRequest">removeUpdatesInRequest</a></li><li><a href="global.html#requestInterceptor">requestInterceptor</a></li><li><a href="global.html#responseInterceptor">responseInterceptor</a></li><li><a href="global.html#restore">restore</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setDefaultRequestInterceptor">setDefaultRequestInterceptor</a></li><li><a href="global.html#setDefaultResponseInterceptor">setDefaultResponseInterceptor</a></li><li><a href="global.html#setGlobalHashFn">setGlobalHashFn</a></li><li><a href="global.html#setRecordHashFn">setRecordHashFn</a></li><li><a href="global.html#setRequestInterceptor">setRequestInterceptor</a></li><li><a href="global.html#setResponseInterceptor">setResponseInterceptor</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#stopAll">stopAll</a></li><li><a href="global.html#sync">sync</a></li><li><a href="global.html#syncRecords">syncRecords</a></li><li><a href="global.html#SyncScheduler">SyncScheduler</a></li><li><a href="global.html#syncWithBackend">syncWithBackend</a></li><li><a href="global.html#updateHandler">updateHandler</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri May 19 2017 18:47:37 GMT+0100 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
